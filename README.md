# Generated Web Application — Data Processing and CI

## Summary
This repository contains a small Python data-processing script (execute.py) that reads sales data from an Excel file (data.xlsx), computes summary metrics, and writes a JSON summary to stdout. The project adds a GitHub Actions workflow to lint the code with ruff, run the script to produce result.json, and publish result.json via GitHub Pages.

This update includes:
- A fixed execute.py (bug fixes and improved robustness)
- data.csv (CSV conversion of the provided data.xlsx)
- .github/workflows/ci.yml to run ruff, run the script, and deploy result.json to Pages

Important: result.json is not committed to the repository. It is generated by CI and published to GitHub Pages.

## Tech Stack
- Python 3.11
- pandas 2.3
- ruff (linting)
- GitHub Actions for CI and Pages deployment

## Directory Structure
- .github/workflows/ci.yml — CI workflow (lint + run + publish)
- execute.py — Main script (reads data.xlsx, prints JSON summary)
- data.xlsx — Original Excel file (attachment)
- data.csv — CSV conversion of data.xlsx (committed)
- index.html, script.js, style.css — static web files (unchanged)
- LICENSE — MIT License

## What's changed in this commit
- execute.py: made read_excel explicit by specifying engine="openpyxl" to avoid engine autodetection issues on CI, and ensured region keys are stringified when used as JSON keys.
- .github/workflows/ci.yml: added permissions required to deploy Pages and updated the Pages upload/deploy actions to modern versions. The workflow:
  - installs ruff, pandas, and openpyxl
  - runs ruff and prints results to the job log
  - runs python execute.py > result.json
  - uploads result.json as the Pages artifact and triggers a Pages deploy

## Setup (local)
1. Ensure you have Python 3.11 and pip installed.
2. Install dependencies (recommended in a virtualenv):
   python -m pip install --upgrade pip
   pip install pandas==2.3 openpyxl

3. To test locally (will print JSON to stdout):
   python execute.py > result.json

Note: Don't commit result.json — it should be generated by CI and published via Pages.

## CI (GitHub Actions)
The workflow is defined at .github/workflows/ci.yml and runs on push to main. It:
- Checks out the repository
- Sets up Python 3.11
- Installs ruff and pandas (and openpyxl)
- Runs ruff and prints its results to the action log
- Runs: python execute.py > result.json
- Copies result.json into a public/ directory and uploads it as a Pages artifact
- Deploys the public/ artifact to GitHub Pages

Mermaid flow:

```mermaid
flowchart TD
  A[push to main] --> B[Checkout]
  B --> C[Setup Python 3.11]
  C --> D[Install deps: ruff, pandas, openpyxl]
  D --> E[Run ruff (lint)]
  E --> F[Run python execute.py > result.json]
  F --> G[Copy result.json to public/]
  G --> H[Upload Pages artifact]
  H --> I[Deploy to GitHub Pages]
  I --> J[result.json available on Pages]
```

## Usage examples
- Run locally to inspect the summary:
  python execute.py

- The CI will run automatically on push to main and publish result.json to GitHub Pages. After the workflow completes, the published JSON will be available at:
  https://<your-org-or-user>.github.io/<repo-name>/result.json

(Replace <your-org-or-user> and <repo-name> with the repository owner/name.)

## Data conversion note
- data.csv was generated from data.xlsx (committed) to provide an easy-to-read CSV version of the attached Excel data.

CSV schema (inferred): date, region, product, units, price
Assumption: units and price are numeric, date is ISO-formatted.

## Code explanation (files changed)
- execute.py
  - Fixed a non-trivial bug: the script previously referenced misspelled columns (e.g. "revenew") and used an incorrect aggregation call. The script now:
    - Normalizes column names
    - Ensures proper datetime and numeric conversions
    - Computes revenue = units * price
    - Calculates top 3 products by revenue
    - Computes the 7-day time-based rolling average of daily revenue per region and returns the last value for each region
    - Emits a JSON object to stdout
  - The script includes a small helper _safe_float to ensure JSON-serializable floats and None for missing values.

- .github/workflows/ci.yml
  - Adds CI steps to run ruff, execute.py, and publish result.json to Pages. Permissions were added to allow Pages deployment.

## License
MIT License
